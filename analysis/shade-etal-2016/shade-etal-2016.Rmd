---
title: "shade-etal-2016"
author: "rogilmore"
date: "`r Sys.time()`"
output: html_document
---

This document depicts a series of visualizations and analyses that build upon the the Vedak et al. (2015) presentation at the Vision Sciences Society 2015 meeting.

Vedak, S.C, Gilmore, R.O., Kohler, P.J., Liu, Y., & Norcia, A.M. (2015, May). The salience of lower-order features in highly similar wallpaper groups. Poster presented at the Vision Sciences Society meeting, St. Pete Beach, FL.

Gilmore, R.O., & Norcia, A.M. (2014). The Salience of Lower-Order, Localized Features in Highly Self-Similar Wallpaper Groups. Databrary. Retrieved May 18, 2015 from <http://databrary.org/volume/77>.

## Set-up

```{r set-libraries-paths-externals}
require(ggplot2)
require(dplyr)
require(xlsx)
require(lme4)
require(png)

path.2.this.analysis <- 'shade-etal-2016'
path.2.xlsx <- '../../xlsx' # from shade-etal-2016/
path.2.csv <- '../../csv'

data.xlsx <- 'Raw_Sorting_Data_151102.xlsx'
db.wallpapers <- 'wallpapers-on-databrary.csv'
wallpaper.groups <- c('P1', 'P3M1', 'P31M', 'P6', 'P6M')

source("jaccard.data.R")
source("jaccard.R")
source("load.wp.R")
```

## Import raw data and calculate Jaccard indices

Raw data were captured as Excel spreadsheets. These can be found in [symmetry-sorting/xlsx/](../xlsx).

```{r import-clean-raw}

P1.df <- read.xlsx(paste(path.2.xlsx, data.xlsx, sep="/"), sheetName = wallpaper.groups[1])
P3M1.df <- read.xlsx(paste(path.2.xlsx, data.xlsx, sep="/"), sheetName = wallpaper.groups[2])
P31M.df <- read.xlsx(paste(path.2.xlsx, data.xlsx, sep="/"), sheetName = wallpaper.groups[3])
P6.df <- read.xlsx(paste(path.2.xlsx, data.xlsx, sep="/"), sheetName = wallpaper.groups[4])
P6M.df <- read.xlsx(paste(path.2.xlsx, data.xlsx, sep="/"), sheetName = wallpaper.groups[5])

# Rename NSets column
names(P1.df)[23]<-"Nsets"
names(P3M1.df)[23]<-"Nsets"
names(P31M.df)[23]<-"Nsets"
names(P6.df)[23]<-"Nsets"
names(P6M.df)[23]<-"Nsets"

# Rename exemplars
names(P1.df)[3:22]<-c(as.character(1:20))
names(P3M1.df)[3:22]<-c(as.character(1:20))
names(P31M.df)[3:22]<-c(as.character(1:20))
names(P6.df)[3:22]<-c(as.character(1:20))
names(P6M.df)[3:22]<-c(as.character(1:20))

# Merge into data frame
n.sets.df <- rbind(P1.df, P3M1.df, P31M.df, P6.df, P6M.df)

n.sets.df$Group <- c(rep('P1', dim(P1.df)[1]), 
                             rep('P3M1', dim(P3M1.df)[1]),
                             rep('P31M', dim(P31M.df)[1]),
                             rep('P6', dim(P6.df)[1]),
                             rep('P6M', dim(P6M.df)[1])
                            )
```

```{r calculate-jaccard}
# Calculate Jaccard indices, then merge

P1.jaccard <- jaccard.data(P1.df)
P3M1.jaccard <- jaccard.data(P3M1.df)
P31M.jaccard <- jaccard.data(P31M.df)
P6.jaccard <- jaccard.data(P6.df)
P6M.jaccard <- jaccard.data(P6M.df)

jaccard.nodups <- rbind(P1.jaccard, P3M1.jaccard, P31M.jaccard, P6.jaccard, P6M.jaccard)

jaccard.df <- data_frame(Exemplar.Row = jaccard.nodups[,1], 
                                Exemplar.Col = jaccard.nodups[,2], 
                                Jaccard = jaccard.nodups[,3])

jaccard.df$Group <- c(rep('P1', dim(P1.jaccard)[1]), 
                             rep('P3M1', dim(P3M1.jaccard)[1]),
                             rep('P31M', dim(P31M.jaccard)[1]),
                             rep('P6', dim(P6.jaccard)[1]),
                             rep('P6M', dim(P6M.jaccard)[1])
                            )
```

## Illustrative image exemplars

### P1, 101001

```{r images-from-Databrary-P1}
pp <- load.wp("P1", 1, fn.df=paste(path.2.csv, db.wallpapers, sep='/'))
plot.new()
plot.window(xlim=c(0,1), ylim=c(0,1), asp=1) # square aspect ratio
rasterImage(pp, 0, 0, 1, 1)
```

### P3M1, exemplar 1

```{r images-from-Databrary-P3M1}
pp <- load.wp("P3M1", 1, fn.df=paste(path.2.csv, db.wallpapers, sep='/'))
plot.new()
plot.window(xlim=c(0,1), ylim=c(0,1), asp=1) # square aspect ratio
rasterImage(pp, 0, 0, 1, 1)
```

### P6M, exemplar 1

```{r images-from-Databrary-P6M}
pp <- load.wp("P6M", 1, fn.df=paste(path.2.csv, db.wallpapers, sep='/'))
plot.new()
plot.window(xlim=c(0,1), ylim=c(0,1), asp=1) # square aspect ratio
rasterImage(pp, 0, 0, 1, 1)
```

## Jaccard indices across exemplars, participants

### Histogram
```{r, echo=FALSE}
theme.symm <- theme( axis.title.x = element_text(size=18),
                       axis.title.y = element_text(size=18),
                       strip.text = element_text(size=16),
                       axis.text = element_text(size=14),
                       legend.text = element_text(size=14),
                       legend.title = element_text(size=14)
)

qplot(x=Jaccard, 
      data=jaccard.df, 
      geom=c("histogram"), 
      facets = Group ~ ., fill=Group ) + 
  labs( x="Jaccard Index", y="N observations") +
  theme.symm +
  guides( fill=FALSE )
```

## Jaccard indices by exemplar

```{r}
# Re-read data files to includes a,b and b,a scores for each
# exemplar pair. Of course j(a,b)=j(b,a), but we need both scores to show 
# exemplar-by-exemplar patterns. In the future, just do this then filter.

P1.jaccard <- jaccard.data(P1.df, duplicates=TRUE)
P3M1.jaccard <- jaccard.data(P3M1.df, duplicates=TRUE)
P31M.jaccard <- jaccard.data(P31M.df, duplicates=TRUE)
P6.jaccard <- jaccard.data(P6.df, duplicates=TRUE)
P6M.jaccard <- jaccard.data(P6M.df, duplicates=TRUE)

jaccard.all <- rbind(P1.jaccard, P3M1.jaccard, P31M.jaccard, P6.jaccard, P6M.jaccard)

jaccard.all.df <- data_frame(Exemplar.Row = jaccard.all[,1], 
                                Exemplar.Col = jaccard.all[,2], 
                                Jaccard = jaccard.all[,3])

jaccard.all.df$Group <- c(rep('P1', dim(P1.jaccard)[1]), 
                             rep('P3M1', dim(P3M1.jaccard)[1]),
                             rep('P31M', dim(P31M.jaccard)[1]),
                             rep('P6', dim(P6.jaccard)[1]),
                             rep('P6M', dim(P6M.jaccard)[1])
                      )

#jaccard.all.df <- read.csv("jaccard-all.csv")

# Select a,b and b,a but not a,a pairs
jaccard.select <- with(jaccard.all.df, !(Exemplar.Row==Exemplar.Col))
```

### Boxplot

```{r, echo=FALSE}
qplot(data=jaccard.all.df[jaccard.select,],
      x=as.factor(Exemplar.Row), y=Jaccard,
      facets = Group ~ .,
      fill=Group, 
      geom="boxplot",
      xlab = "Exemplar")
```
